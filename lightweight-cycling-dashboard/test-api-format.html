<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Format Parsing</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        pre { background: #333; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>API Format Parsing Test</h1>
    <div id="test-results"></div>
    
    <script src="scripts/data-fetcher.js"></script>
    <script src="scripts/ranking-renderer.js"></script>
    <script>
        function addResult(test, passed, details = '') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `<strong>${test}:</strong> ${passed ? 'âœ… PASS' : 'âŒ FAIL'} ${details}`;
            results.appendChild(div);
        }
        
        // Mock leaderboard aggregate API response format
        const mockApiResponse = [
            {
                "_id": "gabriellydupin@gmail.com_FfgmTnN",
                "total": 188963.08,
                "position": 1,
                "move": "up",
                "player": "gabriellydupin@gmail.com",
                "name": "Gabrielly",
                "extra": {"cache": "FfgmTnN"},
                "boardId": "FbdmEIT"
            },
            {
                "_id": "gabriellima.aurum@gmail.com_FfgmTnN",
                "total": 158664.51,
                "position": 2,
                "move": "up",
                "player": "gabriellima.aurum@gmail.com",
                "name": "Gabriel",
                "extra": {"cache": "FfgmTnN"},
                "boardId": "FbdmEIT"
            },
            {
                "_id": "joicy.aurum@gmail.com_FfgmTnN",
                "total": 124320.6,
                "position": 3,
                "move": "up",
                "player": "joicy.aurum@gmail.com",
                "name": "Joicy",
                "extra": {"cache": "FfgmTnN"},
                "boardId": "FbdmEIT"
            }
        ];
        
        console.log('Testing with mock API response:', mockApiResponse);
        
        try {
            const dataFetcher = new DataFetcher();
            
            // Test data processing
            const processedData = dataFetcher.processPlayerData(mockApiResponse);
            addResult('Data processing', processedData.length > 0, `(${processedData.length} players processed)`);
            
            if (processedData.length > 0) {
                console.log('Processed data:', processedData);
                
                // Show processed data
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(processedData, null, 2);
                document.body.appendChild(pre);
                
                // Test ranking renderer validation
                const mockAssets = [
                    { car: 'gold', image: null, fallback: 'ðŸ¥‡', cssColor: '#FFD700' },
                    { car: 'silver', image: null, fallback: 'ðŸ¥ˆ', cssColor: '#C0C0C0' },
                    { car: 'bronze', image: null, fallback: 'ðŸ¥‰', cssColor: '#CD7F32' }
                ];
                
                const renderer = new RankingRenderer(mockAssets, { maxSpaceships: 10, animationDuration: 1000 });
                const validatedPlayers = renderer.validateAndSanitizePlayers(processedData);
                
                addResult('Player validation', validatedPlayers.length > 0, `(${validatedPlayers.length} players validated)`);
                
                if (validatedPlayers.length > 0) {
                    console.log('Validated players:', validatedPlayers);
                }
            }
            
        } catch (error) {
            addResult('API format test', false, error.message);
            console.error('Test failed:', error);
        }
    </script>
</body>
</html>